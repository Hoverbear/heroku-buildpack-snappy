#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

set -e
set -o pipefail

# Build related variables.
BUILDPACK_DIR=$(pwd)/../
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

if [[ ! -d "$CACHE_DIR/snappy" ]]; then
    mkdir -p $CACHE_DIR
    cd $CACHE_DIR
    git clone https://github.com/google/snappy
    cd snappy
    ./autogen.sh
    ./configure --prefix="$CACHE_DIR/snappy-build"
    make
    make install
fi

echo > $BUILDPACK_DIR/export <<EOF
LD_LIBRARY_PATH="/app/tmp/cache/snappy-build/lib"
LB_RUN_PATH="/app/tmp/cache/snappy-build/lib"
EOF

# mkdir -p $BUILD_DIR/.profile.d
# echo > $BUILD_DIR/path.sh <<EOF
# export LD_LIBRARY_PATH="$CACHE_DIR/snappy-build/lib"
# export LB_RUN_PATH="$CACHE_DIR/snappy-build/lib"
# EOF
